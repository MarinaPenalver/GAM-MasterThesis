eye(2)
n = 2
I = diag(1, n)
unos = ones(n)
c(1)*n
n <- 2
I <- diag(n)
uno_n <- matrix(rep(1, n), n, 1)
View(uno_n)
resultado <- I - (1/n) * uno_n %*% t(uno_n)
I - (1/n) * uno_n %*% t(uno_n)
n <- 4
I <- diag(n)
uno_n <- matrix(rep(1, n), n, 1)
I - (1/n) * uno_n %*% t(uno_n)
n <- 4
I <- diag(n)
uno_n <- matrix(rep(1, n), n, 1)
I - (1/n) * uno_n %*% t(uno_n)
Q <- I - (1/n) * uno_n %*% t(uno_n)
X <- matrix(1:12, nrow = 3, ncol = 4)
X
X <- matrix(1:12, nrow = 4, ncol = 3)
X
3
3
X <- matrix(1:12, nrow = 3, ncol = 4)
X
X <- matrix(1:12, nrow = 4, ncol = 3)
X
Q*X
dim(Q)
dim(X)
Q %*% X
uno_n %*% X
t(uno_n) %*% X
Q %*% X
Q %*% Q %*% X
citation(lm)
?lm
citation("lm")
citation("MASS")
citation("stats")
citation("MASS")
R2.gam2 <- vector(mode = "numeric", length = 20)
t1 = Sys.time()
for(i in 1:20)
{   y = as.numeric(NBdata[i,])
gam1=gam(y ~ ns(Time,df = 1 + 3)*Group, family=poisson())
R2.gam2[i] = R2(gam1)
}
library(maSigPro)
data(NBdata)
data(NBdesign)
Time=NBdesign[,1]
G = NBdesign[,3:4]
Group = G[,1]+2*G[,2]
Group = factor(Group, labels = colnames(G))
R2 = function(model){(model$null.deviance-model$deviance)/model$null.deviance}
d <- make.design.matrix(NBdesign)
NBp <- p.vector(NBdata, d, counts=TRUE, family = poisson())
NBp$p.vector #este vector tiene los p.vals de los modelos con todas las vars.
p.gam <- vector(mode = "numeric", length = 100)
R2.gam <- vector(mode = "numeric", length = 100)
for(i in 1:100)
{
y = as.numeric(NBdata[i,])
gam0 = gam(y~1, family=poisson())
gam1=gam(y~ns(Time,df=1+3)*Group, family=poisson())
test = anova(gam0,gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1) #lo pongo por curiosidad, pero el
}
library(mgcv)
library(splines)
p.gam <- vector(mode = "numeric", length = 100)
R2.gam <- vector(mode = "numeric", length = 100)
for(i in 1:100)
{
y = as.numeric(NBdata[i,])
gam0 = gam(y~1, family=poisson())
gam1=gam(y~ns(Time,df=1+3)*Group, family=poisson())
test = anova(gam0,gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1) #lo pongo por curiosidad, pero el
}
which(p.gam<0.05)
sum(p.gam<0.05)
p.gam
# esto es sólo un chequeo para que veas cómo funciona la función p.vector.
p.vector <- vector(mode = "numeric", length = 100)
R2.glm <- vector(mode = "numeric", length = 100)
for(i in 1:100)
{
y = as.numeric(NBdata[i,])
glm0 = glm(y~1, family=poisson(),epsilon=1e-5)
glm1 <- glm(y ~ Time*Group, family=poisson(),epsilon=1e-5)
test = anova(glm0,glm1, test = "Chisq")
p.vector[i] = test[5][2, 1]
R2.glm[i] = R2(glm1)
}
max(p.vector-NBp$p.vector) #se puede ver que es lo mismo
p.adjusted <- p.adjust(p.vector, method ="BH", n = length(p.vector))
which(p.adjusted<0.05)
sum(p.adjusted<0.05)
p.vector
citation("splines")
?smooth.spline
?splines
citation("splines")
citation("maSigPro")
library(maSigPro)
data(NBdata)
data(NBdesign)
d <- make.design.matrix(NBdesign)
design <- as.data.frame(NBdesign)
# Función de maSigPro con GLM
fit <- p.vector(NBdata, d, Q = 0.05, MT.adjust = "BH", min.obs = 20, family=poisson())
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t1 - t2
tstep$sol$`R-squared`
t2 - t1
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
# GAM
library(mcgv)
library(splines)
# GAM
library(mgcv)
library(splines)
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
Time=NBdesign[,1]
G = NBdesign[,3:4]
Group = G[,1]+2*G[,2]
Group = factor(Group, labels = colnames(G))
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
R2 = function(model){(model$null.deviance-model$deviance)/model$null.deviance}
# GAM
library(mgcv)
library(splines)
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
?gam
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson(), epsilon=1e-5)
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson(), epsilon=1e-1)
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:100){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
which(p.gam<0.05)
sum(p.gam<0.05)   # Selecciona los 20
p.gam
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
# Media de tiempos
n_reps <- 100
times <- numeric(n_reps)
for (i in 1:n_reps) {
t1 <- Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family = poisson())
t2 <- Sys.time()
times[i] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
t1 = Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family=poisson())
t2 = Sys.time()
t2 - t1
# Media de tiempos
n_reps <- 100
times <- numeric(n_reps)
for (i in 1:n_reps) {
t1 <- Sys.time()
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family = poisson())
t2 <- Sys.time()
times[i] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
n_reps <- 100
times <- numeric(n_reps)
for (i in 1:n_reps) {
t1 <- Sys.time()
fit <- p.vector(NBdata, d, Q = 0.05, MT.adjust = "BH", min.obs = 20, family=poisson())
tstep <- T.fit(fit, step.method = "backward", alfa = 0.05, family = poisson())
t2 <- Sys.time()
times[i] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
t1 = Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for(i in 1:20){
y = as.numeric(NBdata[i, ])
gam0 = gam(y ~ 1, family = poisson())
gam1=gam(y ~ ns(Time, df = 1 + 3)*Group, family = poisson())
test = anova(gam0, gam1, test = "Chisq")
p.gam[i] = test[5][2, 1]
R2.gam[i] = R2(gam1)
}
t2 = Sys.time()
t2 - t1
n_reps <- 100
times <- numeric(n_reps)
for (j in 1:n_reps) {
t1 <- Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for (i in 1:20) {
y <- as.numeric(NBdata[i, ])
gam0 <- gam(y ~ 1, family = poisson())
gam1 <- gam(y ~ ns(Time, df = 1 + 3) * Group, family = poisson())
test <- anova(gam0, gam1, test = "Chisq")
p.gam[i] <- test[5][2, 1]
R2.gam[i] <- R2(gam1)
}
t2 <- Sys.time()
times[j] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
# Media de tiempos
n_reps <- 100
times <- numeric(n_reps)
for (j in 1:n_reps) {
t1 <- Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for (i in 1:20) {
y <- as.numeric(NBdata[i, ])
# gam0 <- gam(y ~ 1, family = poisson())
gam1 <- gam(y ~ ns(Time, df = 1 + 3) * Group, family = poisson())
# test <- anova(gam0, gam1, test = "Chisq")
# p.gam[i] <- test[5][2, 1]
R2.gam[i] <- R2(gam1)
}
t2 <- Sys.time()
times[j] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
n_reps <- 100
times <- numeric(n_reps)
for (j in 1:n_reps) {
t1 <- Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for (i in 1:100) {
y <- as.numeric(NBdata[i, ])
# gam0 <- gam(y ~ 1, family = poisson())
gam1 <- gam(y ~ ns(Time, df = 1 + 3) * Group, family = poisson())
# test <- anova(gam0, gam1, test = "Chisq")
# p.gam[i] <- test[5][2, 1]
R2.gam[i] <- R2(gam1)
}
t2 <- Sys.time()
times[j] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
n_reps <- 100
times <- numeric(n_reps)
for (j in 1:n_reps) {
t1 <- Sys.time()
p.gam <- vector(mode = "numeric", length = 20)
R2.gam <- vector(mode = "numeric", length = 20)
for (i in 1:100) {
y <- as.numeric(NBdata[i, ])
gam0 <- gam(y ~ 1, family = poisson())
gam1 <- gam(y ~ ns(Time, df = 1 + 3) * Group, family = poisson())
test <- anova(gam0, gam1, test = "Chisq")
p.gam[i] <- test[5][2, 1]
R2.gam[i] <- R2(gam1)
}
t2 <- Sys.time()
times[j] <- as.numeric(difftime(t2, t1, units = "secs"))
}
mean_time <- mean(times)
cat("El tiempo medio de ejecución es:", mean_time, "segundos\n")
setwd("C:/Users/mpena/MÁSTER/TFM/GitHub/GAM-MasterThesis/code/NBdata")
setwd("C:/Users/mpena/MÁSTER/TFM/GitHub/GAM-MasterThesis/code")
he least squares estimator is
knitr::opts_chunk$set(echo = TRUE)
set.seed(2512)
```{r data-visualization, fig.align='center'}
setwd("C:/Users/mpena/MÁSTER/TFM/GitHub/GAM-MasterThesis")
